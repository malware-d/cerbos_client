[2025-07-17T10:40:54.155Z] 
============================================================
[2025-07-17T10:40:54.158Z] CERBOS ACCOUNT POLICY TEST SUITE
[2025-07-17T10:40:54.158Z] ============================================================
[2025-07-17T10:40:54.158Z] ‚ÑπÔ∏è  Testing account.yaml policy with all roles and scenarios
[2025-07-17T10:40:54.158Z] ‚ÑπÔ∏è  Server: http://localhost:3000
[2025-07-17T10:40:54.159Z] 
--- Testing: READ Account - Client Role ---
[2025-07-17T10:40:54.159Z] ‚ÑπÔ∏è  Description: Client should be able to read account (allowed for client, teller, supervisor, admin)
[2025-07-17T10:40:54.179Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-17T10:40:54.180Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-17T10:40:58.119Z] ‚úÖ PASSED - Status: 200
[2025-07-17T10:40:58.120Z] ‚ÑπÔ∏è  Response: {"id":"acc001","ownerId":"mb000001","name":"Nguyen Van Anh","balance":50000000,"account_type":"normal"}
[2025-07-17T10:40:58.623Z] 
--- Testing: READ Account - Teller Role ---
[2025-07-17T10:40:58.625Z] ‚ÑπÔ∏è  Description: Teller should be able to read account
[2025-07-17T10:40:58.655Z] ‚ÑπÔ∏è  User: Teller User (teller)
[2025-07-17T10:40:58.655Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-17T10:40:58.710Z] ‚úÖ PASSED - Status: 200
[2025-07-17T10:40:58.711Z] ‚ÑπÔ∏è  Response: {"id":"acc001","ownerId":"mb000001","name":"Nguyen Van Anh","balance":50000000,"account_type":"normal"}
[2025-07-17T10:40:59.213Z] 
--- Testing: READ Account - Supervisor Role ---
[2025-07-17T10:40:59.213Z] ‚ÑπÔ∏è  Description: Supervisor should be able to read account
[2025-07-17T10:40:59.219Z] ‚ÑπÔ∏è  User: Supervisor User (supervisor)
[2025-07-17T10:40:59.221Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-17T10:40:59.284Z] ‚úÖ PASSED - Status: 200
[2025-07-17T10:40:59.285Z] ‚ÑπÔ∏è  Response: {"id":"acc001","ownerId":"mb000001","name":"Nguyen Van Anh","balance":50000000,"account_type":"normal"}
[2025-07-17T10:40:59.787Z] 
--- Testing: READ Account - Admin Role ---
[2025-07-17T10:40:59.787Z] ‚ÑπÔ∏è  Description: Admin should be able to read account
[2025-07-17T10:40:59.789Z] ‚ÑπÔ∏è  User: Admin User (admin)
[2025-07-17T10:40:59.789Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-17T10:40:59.810Z] ‚úÖ PASSED - Status: 200
[2025-07-17T10:40:59.810Z] ‚ÑπÔ∏è  Response: {"id":"acc001","ownerId":"mb000001","name":"Nguyen Van Anh","balance":50000000,"account_type":"normal"}
[2025-07-17T10:41:00.312Z] 
--- Testing: UPDATE Account - Client Role (Should Fail) ---
[2025-07-17T10:41:00.313Z] ‚ÑπÔ∏è  Description: Client should NOT be able to update account (only teller, admin allowed)
[2025-07-17T10:41:00.316Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-17T10:41:00.316Z] ‚ÑπÔ∏è  Request: PATCH /accounts/acc001
[2025-07-17T10:41:00.440Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-17T10:41:00.441Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-17T10:41:00.944Z] 
--- Testing: UPDATE Account - Teller Role ---
[2025-07-17T10:41:00.944Z] ‚ÑπÔ∏è  Description: Teller should be able to update account
[2025-07-17T10:41:00.948Z] ‚ÑπÔ∏è  User: Teller User (teller)
[2025-07-17T10:41:00.948Z] ‚ÑπÔ∏è  Request: PATCH /accounts/acc001
[2025-07-17T10:41:01.057Z] ‚úÖ PASSED - Status: 200
[2025-07-17T10:41:01.059Z] ‚ÑπÔ∏è  Response: {"result":"Updated account acc001"}
[2025-07-17T10:41:01.560Z] 
--- Testing: UPDATE Account - Admin Role ---
[2025-07-17T10:41:01.561Z] ‚ÑπÔ∏è  Description: Admin should be able to update account
[2025-07-17T10:41:01.567Z] ‚ÑπÔ∏è  User: Admin User (admin)
[2025-07-17T10:41:01.568Z] ‚ÑπÔ∏è  Request: PATCH /accounts/acc001
[2025-07-17T10:41:01.603Z] ‚úÖ PASSED - Status: 200
[2025-07-17T10:41:01.603Z] ‚ÑπÔ∏è  Response: {"result":"Updated account acc001"}
[2025-07-17T10:41:02.104Z] 
--- Testing: CREATE Account - Client Role (Should Fail) ---
[2025-07-17T10:41:02.105Z] ‚ÑπÔ∏è  Description: Client should NOT be able to create account (only admin allowed)
[2025-07-17T10:41:02.106Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-17T10:41:02.106Z] ‚ÑπÔ∏è  Request: POST /accounts/new
[2025-07-17T10:41:02.129Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-17T10:41:02.129Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-17T10:41:02.629Z] 
--- Testing: CREATE Account - Teller Role (Should Fail) ---
[2025-07-17T10:41:02.630Z] ‚ÑπÔ∏è  Description: Teller should NOT be able to create account (only admin allowed)
[2025-07-17T10:41:02.631Z] ‚ÑπÔ∏è  User: Teller User (teller)
[2025-07-17T10:41:02.631Z] ‚ÑπÔ∏è  Request: POST /accounts/new
[2025-07-17T10:41:02.684Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-17T10:41:02.684Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-17T10:41:03.185Z] 
--- Testing: CREATE Account - Admin Role ---
[2025-07-17T10:41:03.185Z] ‚ÑπÔ∏è  Description: Admin should be able to create account
[2025-07-17T10:41:03.188Z] ‚ÑπÔ∏è  User: Admin User (admin)
[2025-07-17T10:41:03.188Z] ‚ÑπÔ∏è  Request: POST /accounts/new
[2025-07-17T10:41:03.204Z] ‚úÖ PASSED - Status: 200
[2025-07-17T10:41:03.205Z] ‚ÑπÔ∏è  Response: {"result":"Created account"}
[2025-07-17T10:41:03.706Z] 
--- Testing: TRANSFER - Client with Small Amount (‚â§ 100M) ---
[2025-07-17T10:41:03.706Z] ‚ÑπÔ∏è  Description: Client should be able to transfer amounts ‚â§ 100M VND
[2025-07-17T10:41:03.707Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-17T10:41:03.708Z] ‚ÑπÔ∏è  Request: POST /accounts/acc001/transfer
[2025-07-17T10:41:03.708Z] ‚ÑπÔ∏è  Data: {"amount":50000000}
[2025-07-17T10:41:03.759Z] ‚úÖ PASSED - Status: 200
[2025-07-17T10:41:03.759Z] ‚ÑπÔ∏è  Response: {"result":"Transferred 50000000 from account acc001"}
[2025-07-17T10:41:04.262Z] 
--- Testing: TRANSFER - Client with Large Amount (> 100M) (Should Fail) ---
[2025-07-17T10:41:04.263Z] ‚ÑπÔ∏è  Description: Client should NOT be able to transfer amounts > 100M VND
[2025-07-17T10:41:04.264Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-17T10:41:04.264Z] ‚ÑπÔ∏è  Request: POST /accounts/acc001/transfer
[2025-07-17T10:41:04.264Z] ‚ÑπÔ∏è  Data: {"amount":150000000}
[2025-07-17T10:41:04.288Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-17T10:41:04.288Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-17T10:41:04.789Z] 
--- Testing: TRANSFER - Client with Exact Limit (100M) ---
[2025-07-17T10:41:04.791Z] ‚ÑπÔ∏è  Description: Client should be able to transfer exactly 100M VND
[2025-07-17T10:41:04.795Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-17T10:41:04.795Z] ‚ÑπÔ∏è  Request: POST /accounts/acc001/transfer
[2025-07-17T10:41:04.795Z] ‚ÑπÔ∏è  Data: {"amount":100000000}
[2025-07-17T10:41:04.824Z] ‚úÖ PASSED - Status: 200
[2025-07-17T10:41:04.824Z] ‚ÑπÔ∏è  Response: {"result":"Transferred 100000000 from account acc001"}
[2025-07-17T10:41:05.326Z] 
--- Testing: TRANSFER - VIP Client with Large Amount ---
[2025-07-17T10:41:05.326Z] ‚ÑπÔ∏è  Description: VIP Client should be able to transfer any amount
[2025-07-17T10:41:05.328Z] ‚ÑπÔ∏è  User: Dao Van Binh (vip_client)
[2025-07-17T10:41:05.329Z] ‚ÑπÔ∏è  Request: POST /accounts/acc002/transfer
[2025-07-17T10:41:05.329Z] ‚ÑπÔ∏è  Data: {"amount":1500000000}
[2025-07-17T10:41:05.356Z] ‚úÖ PASSED - Status: 200
[2025-07-17T10:41:05.356Z] ‚ÑπÔ∏è  Response: {"result":"Transferred 1500000000 from account acc002"}
[2025-07-17T10:41:05.857Z] 
--- Testing: TRANSFER - Teller Role (Should Fail) ---
[2025-07-17T10:41:05.857Z] ‚ÑπÔ∏è  Description: Teller should NOT be able to transfer (only client roles allowed)
[2025-07-17T10:41:05.858Z] ‚ÑπÔ∏è  User: Teller User (teller)
[2025-07-17T10:41:05.858Z] ‚ÑπÔ∏è  Request: POST /accounts/acc001/transfer
[2025-07-17T10:41:05.858Z] ‚ÑπÔ∏è  Data: {"amount":50000000}
[2025-07-17T10:41:05.872Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-17T10:41:05.872Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-17T10:41:06.376Z] 
--- Testing: TRANSFER - Admin Role (Should Fail) ---
[2025-07-17T10:41:06.376Z] ‚ÑπÔ∏è  Description: Admin should NOT be able to transfer (only client roles allowed)
[2025-07-17T10:41:06.381Z] ‚ÑπÔ∏è  User: Admin User (admin)
[2025-07-17T10:41:06.381Z] ‚ÑπÔ∏è  Request: POST /accounts/acc001/transfer
[2025-07-17T10:41:06.381Z] ‚ÑπÔ∏è  Data: {"amount":50000000}
[2025-07-17T10:41:06.406Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-17T10:41:06.409Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-17T10:41:06.910Z] 
--- Testing: READ Account - Expired JWT (Should Fail) ---
[2025-07-17T10:41:06.910Z] ‚ÑπÔ∏è  Description: Should fail when using expired JWT token
[2025-07-17T10:41:06.912Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-17T10:41:06.912Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-17T10:41:06.923Z] ‚úÖ PASSED - Status: 401 (Expected failure)
[2025-07-17T10:41:06.924Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized","details":"Token has expired","code":"token_expired"}
[2025-07-17T10:41:06.924Z] ‚ÑπÔ∏è  Error Details: Token has expired
[2025-07-17T10:41:07.427Z] 
--- Testing: READ Account - Wrong JWT Secret (MITM) (Should Fail) ---
[2025-07-17T10:41:07.428Z] ‚ÑπÔ∏è  Description: Should fail when using JWT signed with wrong secret (simulating MITM attack)
[2025-07-17T10:41:07.431Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-17T10:41:07.431Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-17T10:41:07.523Z] ‚úÖ PASSED - Status: 401 (Expected failure)
[2025-07-17T10:41:07.524Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized","details":"Invalid token signature","code":"invalid_signature"}
[2025-07-17T10:41:07.524Z] ‚ÑπÔ∏è  Error Details: Invalid token signature
[2025-07-17T10:41:08.025Z] 
============================================================
[2025-07-17T10:41:08.026Z] TEST RESULTS SUMMARY
[2025-07-17T10:41:08.026Z] ============================================================
[2025-07-17T10:41:08.026Z] ‚ÑπÔ∏è  Total Tests: 18
[2025-07-17T10:41:08.026Z] ‚úÖ Passed: 18
[2025-07-17T10:41:08.026Z] ‚ùå Failed: 0
[2025-07-17T10:41:08.026Z] ‚úÖ 
üéâ ALL TESTS PASSED! Account policy is working correctly.
