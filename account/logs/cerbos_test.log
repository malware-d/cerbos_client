[2025-07-18T02:24:58.514Z] 
============================================================
[2025-07-18T02:24:58.516Z] CERBOS ACCOUNT POLICY TEST SUITE
[2025-07-18T02:24:58.516Z] ============================================================
[2025-07-18T02:24:58.517Z] ‚ÑπÔ∏è  Testing account.yaml policy with all roles and scenarios
[2025-07-18T02:24:58.517Z] ‚ÑπÔ∏è  Server: http://localhost:3000
[2025-07-18T02:24:58.517Z] 
--- Testing: READ Account - Client Role ---
[2025-07-18T02:24:58.517Z] ‚ÑπÔ∏è  Description: Client should be able to read account (allowed for client, teller, supervisor, admin)
[2025-07-18T02:24:58.523Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-18T02:24:58.523Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-18T02:24:58.901Z] ‚úÖ PASSED - Status: 200
[2025-07-18T02:24:58.901Z] ‚ÑπÔ∏è  Response: {"id":"acc001","ownerId":"mb000001","name":"Nguyen Van Anh","balance":50000000,"account_type":"normal"}
[2025-07-18T02:24:59.404Z] 
--- Testing: READ Account - Teller Role ---
[2025-07-18T02:24:59.405Z] ‚ÑπÔ∏è  Description: Teller should be able to read account
[2025-07-18T02:24:59.418Z] ‚ÑπÔ∏è  User: Teller User (teller)
[2025-07-18T02:24:59.419Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-18T02:24:59.453Z] ‚úÖ PASSED - Status: 200
[2025-07-18T02:24:59.454Z] ‚ÑπÔ∏è  Response: {"id":"acc001","ownerId":"mb000001","name":"Nguyen Van Anh","balance":50000000,"account_type":"normal"}
[2025-07-18T02:24:59.957Z] 
--- Testing: READ Account - Supervisor Role ---
[2025-07-18T02:24:59.958Z] ‚ÑπÔ∏è  Description: Supervisor should be able to read account
[2025-07-18T02:24:59.961Z] ‚ÑπÔ∏è  User: Supervisor User (supervisor)
[2025-07-18T02:24:59.961Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-18T02:24:59.991Z] ‚úÖ PASSED - Status: 200
[2025-07-18T02:24:59.992Z] ‚ÑπÔ∏è  Response: {"id":"acc001","ownerId":"mb000001","name":"Nguyen Van Anh","balance":50000000,"account_type":"normal"}
[2025-07-18T02:25:00.493Z] 
--- Testing: READ Account - Admin Role ---
[2025-07-18T02:25:00.493Z] ‚ÑπÔ∏è  Description: Admin should be able to read account
[2025-07-18T02:25:00.495Z] ‚ÑπÔ∏è  User: Admin User (admin)
[2025-07-18T02:25:00.495Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-18T02:25:00.506Z] ‚úÖ PASSED - Status: 200
[2025-07-18T02:25:00.521Z] ‚ÑπÔ∏è  Response: {"id":"acc001","ownerId":"mb000001","name":"Nguyen Van Anh","balance":50000000,"account_type":"normal"}
[2025-07-18T02:25:01.022Z] 
--- Testing: UPDATE Account - Client Role (Should Fail) ---
[2025-07-18T02:25:01.022Z] ‚ÑπÔ∏è  Description: Client should NOT be able to update account (only teller, admin allowed)
[2025-07-18T02:25:01.024Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-18T02:25:01.024Z] ‚ÑπÔ∏è  Request: PATCH /accounts/acc001
[2025-07-18T02:25:01.093Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-18T02:25:01.094Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-18T02:25:01.595Z] 
--- Testing: UPDATE Account - Teller Role ---
[2025-07-18T02:25:01.596Z] ‚ÑπÔ∏è  Description: Teller should be able to update account
[2025-07-18T02:25:01.598Z] ‚ÑπÔ∏è  User: Teller User (teller)
[2025-07-18T02:25:01.598Z] ‚ÑπÔ∏è  Request: PATCH /accounts/acc001
[2025-07-18T02:25:01.616Z] ‚úÖ PASSED - Status: 200
[2025-07-18T02:25:01.617Z] ‚ÑπÔ∏è  Response: {"result":"Updated account acc001"}
[2025-07-18T02:25:02.120Z] 
--- Testing: UPDATE Account - Admin Role ---
[2025-07-18T02:25:02.122Z] ‚ÑπÔ∏è  Description: Admin should be able to update account
[2025-07-18T02:25:02.125Z] ‚ÑπÔ∏è  User: Admin User (admin)
[2025-07-18T02:25:02.125Z] ‚ÑπÔ∏è  Request: PATCH /accounts/acc001
[2025-07-18T02:25:02.149Z] ‚úÖ PASSED - Status: 200
[2025-07-18T02:25:02.149Z] ‚ÑπÔ∏è  Response: {"result":"Updated account acc001"}
[2025-07-18T02:25:02.650Z] 
--- Testing: CREATE Account - Client Role (Should Fail) ---
[2025-07-18T02:25:02.651Z] ‚ÑπÔ∏è  Description: Client should NOT be able to create account (only admin allowed)
[2025-07-18T02:25:02.652Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-18T02:25:02.652Z] ‚ÑπÔ∏è  Request: POST /accounts/new
[2025-07-18T02:25:02.724Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-18T02:25:02.724Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-18T02:25:03.225Z] 
--- Testing: CREATE Account - Teller Role (Should Fail) ---
[2025-07-18T02:25:03.225Z] ‚ÑπÔ∏è  Description: Teller should NOT be able to create account (only admin allowed)
[2025-07-18T02:25:03.229Z] ‚ÑπÔ∏è  User: Teller User (teller)
[2025-07-18T02:25:03.229Z] ‚ÑπÔ∏è  Request: POST /accounts/new
[2025-07-18T02:25:03.263Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-18T02:25:03.263Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-18T02:25:03.765Z] 
--- Testing: CREATE Account - Admin Role ---
[2025-07-18T02:25:03.765Z] ‚ÑπÔ∏è  Description: Admin should be able to create account
[2025-07-18T02:25:03.766Z] ‚ÑπÔ∏è  User: Admin User (admin)
[2025-07-18T02:25:03.766Z] ‚ÑπÔ∏è  Request: POST /accounts/new
[2025-07-18T02:25:03.794Z] ‚úÖ PASSED - Status: 200
[2025-07-18T02:25:03.794Z] ‚ÑπÔ∏è  Response: {"result":"Created account"}
[2025-07-18T02:25:04.296Z] 
--- Testing: TRANSFER - Client with Small Amount (‚â§ 100M) ---
[2025-07-18T02:25:04.296Z] ‚ÑπÔ∏è  Description: Client should be able to transfer amounts ‚â§ 100M VND
[2025-07-18T02:25:04.297Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-18T02:25:04.298Z] ‚ÑπÔ∏è  Request: POST /accounts/acc001/transfer
[2025-07-18T02:25:04.298Z] ‚ÑπÔ∏è  Data: {"amount":50000000}
[2025-07-18T02:25:04.323Z] ‚úÖ PASSED - Status: 200
[2025-07-18T02:25:04.324Z] ‚ÑπÔ∏è  Response: {"result":"Transferred 50000000 from account acc001"}
[2025-07-18T02:25:04.825Z] 
--- Testing: TRANSFER - Client with Large Amount (> 100M) (Should Fail) ---
[2025-07-18T02:25:04.826Z] ‚ÑπÔ∏è  Description: Client should NOT be able to transfer amounts > 100M VND
[2025-07-18T02:25:04.829Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-18T02:25:04.830Z] ‚ÑπÔ∏è  Request: POST /accounts/acc001/transfer
[2025-07-18T02:25:04.830Z] ‚ÑπÔ∏è  Data: {"amount":150000000}
[2025-07-18T02:25:04.869Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-18T02:25:04.870Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-18T02:25:05.373Z] 
--- Testing: TRANSFER - Client with Exact Limit (100M) ---
[2025-07-18T02:25:05.374Z] ‚ÑπÔ∏è  Description: Client should be able to transfer exactly 100M VND
[2025-07-18T02:25:05.378Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-18T02:25:05.378Z] ‚ÑπÔ∏è  Request: POST /accounts/acc001/transfer
[2025-07-18T02:25:05.379Z] ‚ÑπÔ∏è  Data: {"amount":100000000}
[2025-07-18T02:25:05.421Z] ‚úÖ PASSED - Status: 200
[2025-07-18T02:25:05.422Z] ‚ÑπÔ∏è  Response: {"result":"Transferred 100000000 from account acc001"}
[2025-07-18T02:25:05.924Z] 
--- Testing: TRANSFER - VIP Client with Large Amount ---
[2025-07-18T02:25:05.926Z] ‚ÑπÔ∏è  Description: VIP Client should be able to transfer any amount
[2025-07-18T02:25:05.927Z] ‚ÑπÔ∏è  User: Dao Van Binh (vip_client)
[2025-07-18T02:25:05.927Z] ‚ÑπÔ∏è  Request: POST /accounts/acc002/transfer
[2025-07-18T02:25:05.927Z] ‚ÑπÔ∏è  Data: {"amount":1500000000}
[2025-07-18T02:25:05.944Z] ‚úÖ PASSED - Status: 200
[2025-07-18T02:25:05.945Z] ‚ÑπÔ∏è  Response: {"result":"Transferred 1500000000 from account acc002"}
[2025-07-18T02:25:06.447Z] 
--- Testing: TRANSFER - Teller Role (Should Fail) ---
[2025-07-18T02:25:06.448Z] ‚ÑπÔ∏è  Description: Teller should NOT be able to transfer (only client roles allowed)
[2025-07-18T02:25:06.449Z] ‚ÑπÔ∏è  User: Teller User (teller)
[2025-07-18T02:25:06.449Z] ‚ÑπÔ∏è  Request: POST /accounts/acc001/transfer
[2025-07-18T02:25:06.449Z] ‚ÑπÔ∏è  Data: {"amount":50000000}
[2025-07-18T02:25:06.473Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-18T02:25:06.473Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-18T02:25:06.974Z] 
--- Testing: TRANSFER - Admin Role (Should Fail) ---
[2025-07-18T02:25:06.975Z] ‚ÑπÔ∏è  Description: Admin should NOT be able to transfer (only client roles allowed)
[2025-07-18T02:25:06.976Z] ‚ÑπÔ∏è  User: Admin User (admin)
[2025-07-18T02:25:06.976Z] ‚ÑπÔ∏è  Request: POST /accounts/acc001/transfer
[2025-07-18T02:25:06.976Z] ‚ÑπÔ∏è  Data: {"amount":50000000}
[2025-07-18T02:25:07.011Z] ‚úÖ PASSED - Status: 403 (Expected failure)
[2025-07-18T02:25:07.012Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized"}
[2025-07-18T02:25:07.512Z] 
--- Testing: READ Account - Expired JWT (Should Fail) ---
[2025-07-18T02:25:07.513Z] ‚ÑπÔ∏è  Description: Should fail when using expired JWT token
[2025-07-18T02:25:07.514Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-18T02:25:07.515Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-18T02:25:07.547Z] ‚úÖ PASSED - Status: 401 (Expected failure)
[2025-07-18T02:25:07.550Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized","details":"Token has expired","code":"token_expired"}
[2025-07-18T02:25:07.551Z] ‚ÑπÔ∏è  Error Details: Token has expired
[2025-07-18T02:25:08.053Z] 
--- Testing: READ Account - Wrong JWT Secret (MITM) (Should Fail) ---
[2025-07-18T02:25:08.054Z] ‚ÑπÔ∏è  Description: Should fail when using JWT signed with wrong secret (simulating MITM attack)
[2025-07-18T02:25:08.057Z] ‚ÑπÔ∏è  User: Nguyen Van Anh (client)
[2025-07-18T02:25:08.057Z] ‚ÑπÔ∏è  Request: GET /accounts/acc001
[2025-07-18T02:25:08.309Z] ‚úÖ PASSED - Status: 401 (Expected failure)
[2025-07-18T02:25:08.311Z] ‚ÑπÔ∏è  Response: {"error":"Unauthorized","details":"Invalid token signature","code":"invalid_signature"}
[2025-07-18T02:25:08.318Z] ‚ÑπÔ∏è  Error Details: Invalid token signature
[2025-07-18T02:25:08.820Z] 
============================================================
[2025-07-18T02:25:08.821Z] TEST RESULTS SUMMARY
[2025-07-18T02:25:08.821Z] ============================================================
[2025-07-18T02:25:08.822Z] ‚ÑπÔ∏è  Total Tests: 18
[2025-07-18T02:25:08.822Z] ‚úÖ Passed: 18
[2025-07-18T02:25:08.823Z] ‚ùå Failed: 0
[2025-07-18T02:25:08.823Z] ‚úÖ 
üéâ ALL TESTS PASSED! Account policy is working correctly.
